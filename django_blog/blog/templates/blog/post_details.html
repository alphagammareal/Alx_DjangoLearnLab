{% extends "blog/base.html" %}
{% load static %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}
  <article>
    <h2>{{ post.title }}</h2>
    <p><small>By {{ post.author.username }} on {{ post.published_date|date:"SHORT_DATETIME_FORMAT" }}</small></p>
    <div>{{ post.content|linebreaks }}</div>

    {% if request.user == post.author %}
      <p>
        <a href="{% url 'blog:post_update' post.pk %}">Edit</a> |
        <a href="{% url 'blog:post_delete' post.pk %}">Delete</a>
      </p>
    {% endif %}
    <p><a href="{% url 'blog:post_list' %}">Back to all posts</a></p>
  </article>

  <h3>Comments</h3>
{% for comment in post.comments.all %}
  <div>
      <p><strong>{{ comment.author.username }}:</strong> {{ comment.content }}</p>
      <p><small>{{ comment.created_at|date:"M d, Y H:i" }}</small></p>
      {% if comment.author == request.user %}
          <a href="{% url 'blog:comment_update' comment.id %}">Edit</a>
          <a href="{% url 'blog:comment_delete' comment.id %}">Delete</a>
      {% endif %}
  </div>
{% empty %}
  <p>No comments yet.</p>
{% endfor %}

{% if user.is_authenticated %}
<h4>Add a comment:</h4>
<form method="post" action="{% url 'blog:add_comment' post.id %}">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit">Post Comment</button>
</form>
{% else %}
<p><a href="{% url 'blog:login' %}">Login</a> to post a comment.</p>
{% endif %}
  
{% endblock %}
